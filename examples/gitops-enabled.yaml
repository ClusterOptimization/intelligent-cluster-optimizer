apiVersion: optimizer.intelligent-cluster-optimizer.io/v1alpha1
kind: OptimizerConfig
metadata:
  name: gitops-optimizer
  namespace: intelligent-optimizer-system
spec:
  # Balanced strategy
  strategy: balanced

  # Target namespaces
  targetNamespaces:
    - production
    - staging

  # Enable dry-run (GitOps will handle actual deployment)
  dryRun: true

  # GitOps export configuration
  gitOpsExport:
    enabled: true
    format: kustomize
    outputPath: "./gitops-exports"
    autoCommit: true
    gitRepository:
      url: "https://github.com/myorg/k8s-manifests.git"
      branch: "optimizer-recommendations"
      baseBranch: "main"
      commitMessage: "chore: apply resource optimization recommendations"
      createPR: true
      prTitle: "Resource Optimization Recommendations"
      prBody: |
        ## Optimizer Recommendations

        This PR contains resource optimization recommendations generated by the Intelligent Cluster Optimizer.

        ### Changes
        - CPU and memory recommendations based on actual usage patterns
        - Optimized for cost and performance

        ### Review Checklist
        - [ ] Review resource changes
        - [ ] Check impact on application performance
        - [ ] Verify no HPA conflicts
        - [ ] Approve and merge
      authSecretName: "git-credentials"

  # Conservative settings since this affects production
  recommendations:
    cpuPercentile: 95
    memoryPercentile: 95
    safetyMargin: 1.3
    historyDuration: "7d"
    minSamples: 500

  # Resource thresholds
  resourceThresholds:
    cpu:
      min: "50m"
      max: "8"
    memory:
      min: "64Mi"
      max: "16Gi"

  # Safety features
  hpaAwareness:
    enabled: true
    conflictPolicy: Skip

  pdbAwareness:
    enabled: true
    respectMinAvailable: true

  circuitBreaker:
    enabled: true
    errorThreshold: 5
    successThreshold: 3
    timeout: "5m"
